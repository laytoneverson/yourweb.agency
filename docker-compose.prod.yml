version: '3'

services:
  php:
    image: "registry-intl.us-west-1.aliyuncs.com/cryptocurrency-yourweb-online/php"
    env_file: .env-prod
    build:
      args:
        - CONFIGPATH=./docker/prod
        - APP_ENV=prod
    environment:
      - "DATABASE_URL=mysql://yourwebdb:Jldl0Ppop3L45689@db:3306/yourwebdb"
      - APP_ENV=prod

  migration-util:
    env_file:
      - .env-prod
    image: "registry-intl.us-west-1.aliyuncs.com/cryptocurrency-yourweb-online/migration-util"
    environment:
      - "DATABASE_URL=mysql://yourwebdb:Jldl0Ppop3L45689@db:3306/yourwebdb"
      - APP_ENV=prod

  web:
    image: "registry-intl.us-west-1.aliyuncs.com/cryptocurrency-yourweb-online/web"
    env_file: .env-prod
    build:
        args:
          - APP_ENV=prod
          - CONFIGPATH=./docker/prod
          - PHP_UPSTREAM_CONTAINER=php
          - PHP_UPSTREAM_PORT=9000
          - APP_SECRET=jQWEytLCVNoiflsjS3er49FSDFS
          - MYSQL_USER=yourwebdb
          - MYSQL_PASSWORD=Jldl0Ppop3L45689
          - MYSQL_HOST=db
          - MYSQL_DATABASE=yourwebdb
    labels:
        aliyun.routing.port_80: nginx
        online.yourweb.site: cryptocurrency
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./var/logs/nginx:/var/log/nginx/viral-fb-profits
    environment:
      - DEVELOPMENT_MODE=false
      - WEB_HTTP=true

  db:
    env_file:
      - .env-prod
    image: "registry-intl.us-west-1.aliyuncs.com/cryptocurrency-yourweb-online/db"
    environment:
      - MYSQL_ROOT_PASSWORD=JHL789KL45689
      - MYSQL_DATABASE=yourwebdb
      - MYSQL_USER=yourwebdb
      - MYSQL_PASSWORD=Jldl0Ppop3L45689
    volumes:
      - mysqlprod:/var/lib/mysql
